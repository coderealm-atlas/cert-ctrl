---
- name: Ensure packaging variables provided
  assert:
    that:
      - install_service_release_version | length > 0
      - install_service_install_prefix | length > 0
      - install_service_asset_name | length > 0
      - install_service_archive_ext | length > 0
    fail_msg: install_service_release_version, install_service_install_prefix, install_service_asset_name, and install_service_archive_ext are required

- name: Upload packaging script
  copy:
    src: "{{ playbook_dir }}/../../scripts/package-windows-release.ps1"
    dest: C:\\temp\\install-service-package.ps1

- name: Package Windows release
  raw: >-
    & "{{ install_service_powershell_executable }}" -NoProfile -NonInteractive -ExecutionPolicy Bypass -File
    "C:\\temp\\install-service-package.ps1"
    -ReleaseVersion "{{ install_service_release_version }}"
    -InstallPrefix "{{ install_service_install_prefix }}"
    -AssetName "{{ install_service_asset_name }}"
    -ArchiveExt "{{ install_service_archive_ext }}"
    -BinaryBasename "{{ install_service_binary_basename }}"
    -StagingRoot "{{ install_service_remote_staging_root }}"
